'use strict';

var Transpiler = require('./transpile/Transpiler');
var through = require('through');
var babel = require('babel-core');

var transpiler = new Transpiler();

function transform(file) {

    var data = '';

    function write(buf) {
        data += buf;
    }

    function end() {

        var js;

        try {
            js = transpiler.transpile(data);
        } catch (e) {
            console.error(e);
            throw e;
        }

        this.queue(babel.transform(js, {
            sourceMaps: true
        }).code);

        this.queue(null);
    }

    if (!/\.wml$/.test(file)) return through();
    return through(write, end);
}

module.exports = transform;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy90cmFuc2Zvcm0uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQUNuRCxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDakMsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDOztBQUVsQyxJQUFJLFVBQVUsR0FBRyxJQUFJLFVBQVUsRUFBRSxDQUFDOztBQUVsQyxTQUFTLFNBQVMsQ0FBQyxJQUFJLEVBQUU7O0FBRXJCLFFBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQzs7QUFFZCxhQUFTLEtBQUssQ0FBQyxHQUFHLEVBQUU7QUFDaEIsWUFBSSxJQUFJLEdBQUcsQ0FBQztLQUNmOztBQUVELGFBQVMsR0FBRyxHQUFHOztBQUVYLFlBQUksRUFBRSxDQUFDOztBQUVQLFlBQUk7QUFDQSxjQUFFLEdBQUcsVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNuQyxDQUFDLE9BQU8sQ0FBQyxFQUFFO0FBQ1IsbUJBQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDakIsa0JBQU0sQ0FBQyxDQUFDO1NBQ1g7O0FBRUQsWUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRTtBQUMzQixzQkFBVSxFQUFFLElBQUk7U0FDbkIsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDOztBQUVULFlBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7S0FFcEI7O0FBRUQsUUFBSSxDQUFDLEFBQUMsUUFBUSxDQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLE9BQU8sRUFBRSxDQUFDO0FBQzdDLFdBQU8sT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztDQUU5Qjs7QUFFRCxNQUFNLENBQUMsT0FBTyxHQUFHLFNBQVMsQ0FBQyIsImZpbGUiOiJ0cmFuc2Zvcm0uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgVHJhbnNwaWxlciA9IHJlcXVpcmUoJy4vdHJhbnNwaWxlL1RyYW5zcGlsZXInKTtcbnZhciB0aHJvdWdoID0gcmVxdWlyZSgndGhyb3VnaCcpO1xudmFyIGJhYmVsID0gcmVxdWlyZSgnYmFiZWwtY29yZScpO1xuXG52YXIgdHJhbnNwaWxlciA9IG5ldyBUcmFuc3BpbGVyKCk7XG5cbmZ1bmN0aW9uIHRyYW5zZm9ybShmaWxlKSB7XG5cbiAgICB2YXIgZGF0YSA9ICcnO1xuXG4gICAgZnVuY3Rpb24gd3JpdGUoYnVmKSB7XG4gICAgICAgIGRhdGEgKz0gYnVmO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVuZCgpIHtcblxuICAgICAgICB2YXIganM7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGpzID0gdHJhbnNwaWxlci50cmFuc3BpbGUoZGF0YSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5xdWV1ZShiYWJlbC50cmFuc2Zvcm0oanMsIHtcbiAgICAgICAgICAgIHNvdXJjZU1hcHM6IHRydWVcbiAgICAgICAgfSkuY29kZSk7XG5cbiAgICAgICAgdGhpcy5xdWV1ZShudWxsKTtcblxuICAgIH1cblxuICAgIGlmICghKC9cXC53bWwkLykudGVzdChmaWxlKSkgcmV0dXJuIHRocm91Z2goKTtcbiAgICByZXR1cm4gdGhyb3VnaCh3cml0ZSwgZW5kKTtcblxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHRyYW5zZm9ybTtcbiJdfQ==