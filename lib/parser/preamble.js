'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
/* The property-seek module literally copied and pasted here for conveinence. */

var ts = function ts(o, txt) {
  var dtxt = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';
  return o.typescript ? txt : dtxt;
};

var view = function view() {
  return '\n\nexport interface View {\n\n render(): HTMLElement;\n findById(id:string): WMLElement;\n\n}\n';
};

var widget = function widget() {
  return '\nexport interface Widget {\n\n  rendered(): void;\n  removed(): void;\n  render(): HTMLElement;\n\n}';
};

var element = function element() {
  return '\nexport type WMLElement = HTMLElement | Node | EventTarget | Widget';
};

exports.default = function (o) {
  return '\nfunction $$boundary_to_dot(value) {\n  return value.split(\'][\').join(\'.\').split(\'[\').join(\'.\');\n}\n\nfunction $$strip_braces(value) {\n  return value.split(\'[\').join(\'.\').split(\']\').join(\'\');\n}\n\nfunction $$escape_dots(value) {\n  value = value.split(\'\\\'\');\n  return (value.length < 3) ? value.join(\'\\\'\') : value.map(function(seg) {\n    if (seg.length < 3) return seg;\n    if ((seg[0] === \'.\') || (seg[seg.length - 1] === \'.\')) return seg;\n    return seg.split(\'.\').join(\'&&\');\n  }).join(\'\');\n}\n\nfunction $$unescape_dots(value) {\n  return value.split(\'&&\').join(\'.\');\n}\n\nfunction $$partify(value) {\n  if (!value) return;\n  return $$escape_dots($$strip_braces($$boundary_to_dot(\'\' + value))).split(\'.\');\n}\n\nfunction $$property(path, o) {\n\n  var parts = $$partify(path);\n  var first;\n\n  if (typeof o !== \'object\')\n    throw new TypeError(\'get(): expects an object got \' + typeof o);\n\n  if (parts.length === 1) return o[$$unescape_dots(parts[0])];\n  if (parts.length === 0) return;\n\n  first = o[parts.shift()];\n\n  return ((typeof o === \'object\') && (o !== null)) ?\n\n    parts.reduce(function(target, prop) {\n      if (target == null) return target;\n      return target[$$unescape_dots(prop)];\n    }, first) : null;\n}\n\nfunction $$adopt(child, e) {\n\n    if (Array.isArray(child))\n      return child.forEach(innerChild => $$adopt(innerChild, e));\n\n    if (child)\n      e.appendChild(\n        (typeof child === \'object\') ?\n        child : document.createTextNode(child || \'\'));\n\n}\n\n/**\n * $$register a Widget or Node by the specified wml:id\n * @param {string} id\n * @param {Widget|Node} target\n * @param {object} ids\n */\nfunction $$register(id, target, ids) {\n\n  if (ids.hasOwnProperty(id))\n    throw new Error(\'Duplicate id \\\'\' +id+\'\\\' detected!\');\n\n  ids[id] = target;\n\n  return target;\n\n}\n\n/**\n * $$text creates a DOMTextNode\n * @param {string} value\n */\nfunction $$text(value) {\n\n  return document.createTextNode(value || \'\');\n\n}\n\n/**\n * $$resolve property access expression to avoid\n * thowing errors if it does not exist.\n * @param {object} head\n * @param {string} path\n */\nfunction $$resolve(head, path) {\n\n  var ret = $$property(path, head);\n\n  return (ret == null) ? \'\' : ret;\n\n}\n\n/**\n * $$node is called to create a regular DOM node\n * @param {string} tag\n * @param {object} attributes\n * @param {array<string|number|Widget>} children\n * @param {View} view\n */\nfunction $$node(tag, attributes, children, view) {\n\n  var e = (tag === \'fragment\') ? document.createDocumentFragment() : document.createElement(tag);\n\n  if (typeof attributes.html === \'object\')\n    Object.keys(attributes.html).forEach(key => {\n\n      if (typeof attributes.html[key] === \'function\') {\n        e[key] = attributes.html[key];\n      } else {\n        e.setAttribute(key, attributes.html[key]);\n      }\n    });\n\n  children.forEach(c => $$adopt(c, e));\n\n  if (attributes.wml)\n    if (attributes.wml.id)\n      $$register(attributes.wml.id, e, view.ids);\n\n  return e;\n\n}\n\n/**\n * Attributes provides an API for reading the\n * attributes supplied to an Element.\n * @param {object} attrs\n */\nclass Attributes {\n\n    constructor(' + ts(o, 'public _attrs:any', '_attrs') + ') {\n\n        this._attrs = _attrs;\n\n    }\n\n    ' + ts(o, 'has(path:string): boolean', 'has(path)') + '{\n\n      return this.read(path) == null;\n\n    }\n\n    /**\n     * read a value form the internal list.\n     * @param {string} path\n     * @param {*} defaultValue - This value is returned if the value is not set.\n     */\n    ' + ts(o, 'read<A>(path:string, defaultValue?:A): A', 'read(path, defaultValue)') + ' {\n\n        var ret = $$property(path.split(\':\').join(\'.\'), this._attrs);\n      return (ret != null) ? ret : (defaultValue != null) ? defaultValue : \'\';\n\n    }\n\n}\n\n\n/**\n * $$widget creates a wml widget.\n * @param {function} Construtor\n * @param {object} attributes\n * @param {array<string|number|Widget>} children\n * @param {View} view\n * @return {Widget}\n */\nfunction $$widget(Constructor, attributes, children, view) {\n\n  var childs = [];\n  var w;\n\n  children.forEach(child => Array.isArray(child) ?\n    childs.push.apply(childs, child) : childs.push(child));\n\n  w = new Constructor(new Attributes(attributes), childs);\n\n  if (attributes.wml)\n    if (attributes.wml.id)\n      $$register(attributes.wml.id, w, view.ids);\n\n  view.widgets.push(w);\n  return w.render();\n\n}\n\n/**\n * $$if is called to create an if conditional construct\n * @param {*} predicate\n * @param {function} positive\n * @param {function} negative\n */\nfunction $$if(predicate, positive, negative) {\n\n  return (predicate) ? positive() : negative();\n\n}\n\n/**\n * $$for is called to create a for loop construct\n * @param {Iterable} collection\n * @param {function} cb\n */\nfunction $$for(collection, cb) {\n\n  if (Array.isArray(collection)) {\n\n    return collection.map(cb);\n\n   } else if (typeof collection === \'object\') {\n\n     return Object.keys(collection).map((key, _, all) => cb(collection[key], key, all));\n\n   }\n\n    return [];\n\n}\n\n/**\n * $$switch simulates a switch statement\n * @param {string|number|boolean} value\n * @param {object} cases\n */\nfunction $$switch(value, cases) {\n\n    var result = cases[value];\n    var defaul = cases.default;\n\n    if (result) return result;\n\n    if (defaul) return defaul;\n\n}\n\n' + ts(o, view()) + '\n' + ts(o, widget()) + '\n' + ts(o, element()) + '\n\n';
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wYXJzZXIvcHJlYW1ibGUuanMiXSwibmFtZXMiOlsidHMiLCJvIiwidHh0IiwiZHR4dCIsInR5cGVzY3JpcHQiLCJ2aWV3Iiwid2lkZ2V0IiwiZWxlbWVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7QUFFQSxJQUFNQSxLQUFLLFNBQUxBLEVBQUssQ0FBQ0MsQ0FBRCxFQUFJQyxHQUFKO0FBQUEsTUFBU0MsSUFBVCx1RUFBZ0IsRUFBaEI7QUFBQSxTQUF1QkYsRUFBRUcsVUFBRixHQUFlRixHQUFmLEdBQXFCQyxJQUE1QztBQUFBLENBQVg7O0FBRUEsSUFBTUUsT0FBTyxTQUFQQSxJQUFPO0FBQUE7QUFBQSxDQUFiOztBQVVBLElBQU1DLFNBQVMsU0FBVEEsTUFBUztBQUFBO0FBQUEsQ0FBZjs7QUFTQSxJQUFNQyxVQUFVLFNBQVZBLE9BQVU7QUFBQTtBQUFBLENBQWhCOztrQkFHZTtBQUFBLG12R0EySUdQLEdBQUdDLENBQUgsRUFBTSxtQkFBTixFQUE0QixRQUE1QixDQTNJSCw2REFpSlRELEdBQUdDLENBQUgsRUFBTSwyQkFBTixFQUFtQyxXQUFuQyxDQWpKUyxpUEE0SlRELEdBQUdDLENBQUgsRUFBTSwwQ0FBTixFQUFrRCwwQkFBbEQsQ0E1SlMsc3ZEQWtQYkQsR0FBR0MsQ0FBSCxFQUFNSSxNQUFOLENBbFBhLFVBbVBiTCxHQUFHQyxDQUFILEVBQU1LLFFBQU4sQ0FuUGEsVUFvUGJOLEdBQUdDLENBQUgsRUFBTU0sU0FBTixDQXBQYTtBQUFBLEMiLCJmaWxlIjoicHJlYW1ibGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBUaGUgcHJvcGVydHktc2VlayBtb2R1bGUgbGl0ZXJhbGx5IGNvcGllZCBhbmQgcGFzdGVkIGhlcmUgZm9yIGNvbnZlaW5lbmNlLiAqL1xuXG5jb25zdCB0cyA9IChvLCB0eHQsIGR0eHQgPSAnJykgPT4gby50eXBlc2NyaXB0ID8gdHh0IDogZHR4dDtcblxuY29uc3QgdmlldyA9ICgpID0+IGBcblxuZXhwb3J0IGludGVyZmFjZSBWaWV3IHtcblxuIHJlbmRlcigpOiBIVE1MRWxlbWVudDtcbiBmaW5kQnlJZChpZDpzdHJpbmcpOiBXTUxFbGVtZW50O1xuXG59XG5gO1xuXG5jb25zdCB3aWRnZXQgPSAoKSA9PiBgXG5leHBvcnQgaW50ZXJmYWNlIFdpZGdldCB7XG5cbiAgcmVuZGVyZWQoKTogdm9pZDtcbiAgcmVtb3ZlZCgpOiB2b2lkO1xuICByZW5kZXIoKTogSFRNTEVsZW1lbnQ7XG5cbn1gO1xuXG5jb25zdCBlbGVtZW50ID0gKCkgPT4gYFxuZXhwb3J0IHR5cGUgV01MRWxlbWVudCA9IEhUTUxFbGVtZW50IHwgTm9kZSB8IEV2ZW50VGFyZ2V0IHwgV2lkZ2V0YDtcblxuZXhwb3J0IGRlZmF1bHQgbyA9PiBgXG5mdW5jdGlvbiAkJGJvdW5kYXJ5X3RvX2RvdCh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUuc3BsaXQoJ11bJykuam9pbignLicpLnNwbGl0KCdbJykuam9pbignLicpO1xufVxuXG5mdW5jdGlvbiAkJHN0cmlwX2JyYWNlcyh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUuc3BsaXQoJ1snKS5qb2luKCcuJykuc3BsaXQoJ10nKS5qb2luKCcnKTtcbn1cblxuZnVuY3Rpb24gJCRlc2NhcGVfZG90cyh2YWx1ZSkge1xuICB2YWx1ZSA9IHZhbHVlLnNwbGl0KCdcXFxcJycpO1xuICByZXR1cm4gKHZhbHVlLmxlbmd0aCA8IDMpID8gdmFsdWUuam9pbignXFxcXCcnKSA6IHZhbHVlLm1hcChmdW5jdGlvbihzZWcpIHtcbiAgICBpZiAoc2VnLmxlbmd0aCA8IDMpIHJldHVybiBzZWc7XG4gICAgaWYgKChzZWdbMF0gPT09ICcuJykgfHwgKHNlZ1tzZWcubGVuZ3RoIC0gMV0gPT09ICcuJykpIHJldHVybiBzZWc7XG4gICAgcmV0dXJuIHNlZy5zcGxpdCgnLicpLmpvaW4oJyYmJyk7XG4gIH0pLmpvaW4oJycpO1xufVxuXG5mdW5jdGlvbiAkJHVuZXNjYXBlX2RvdHModmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlLnNwbGl0KCcmJicpLmpvaW4oJy4nKTtcbn1cblxuZnVuY3Rpb24gJCRwYXJ0aWZ5KHZhbHVlKSB7XG4gIGlmICghdmFsdWUpIHJldHVybjtcbiAgcmV0dXJuICQkZXNjYXBlX2RvdHMoJCRzdHJpcF9icmFjZXMoJCRib3VuZGFyeV90b19kb3QoJycgKyB2YWx1ZSkpKS5zcGxpdCgnLicpO1xufVxuXG5mdW5jdGlvbiAkJHByb3BlcnR5KHBhdGgsIG8pIHtcblxuICB2YXIgcGFydHMgPSAkJHBhcnRpZnkocGF0aCk7XG4gIHZhciBmaXJzdDtcblxuICBpZiAodHlwZW9mIG8gIT09ICdvYmplY3QnKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2dldCgpOiBleHBlY3RzIGFuIG9iamVjdCBnb3QgJyArIHR5cGVvZiBvKTtcblxuICBpZiAocGFydHMubGVuZ3RoID09PSAxKSByZXR1cm4gb1skJHVuZXNjYXBlX2RvdHMocGFydHNbMF0pXTtcbiAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gIGZpcnN0ID0gb1twYXJ0cy5zaGlmdCgpXTtcblxuICByZXR1cm4gKCh0eXBlb2YgbyA9PT0gJ29iamVjdCcpICYmIChvICE9PSBudWxsKSkgP1xuXG4gICAgcGFydHMucmVkdWNlKGZ1bmN0aW9uKHRhcmdldCwgcHJvcCkge1xuICAgICAgaWYgKHRhcmdldCA9PSBudWxsKSByZXR1cm4gdGFyZ2V0O1xuICAgICAgcmV0dXJuIHRhcmdldFskJHVuZXNjYXBlX2RvdHMocHJvcCldO1xuICAgIH0sIGZpcnN0KSA6IG51bGw7XG59XG5cbmZ1bmN0aW9uICQkYWRvcHQoY2hpbGQsIGUpIHtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KGNoaWxkKSlcbiAgICAgIHJldHVybiBjaGlsZC5mb3JFYWNoKGlubmVyQ2hpbGQgPT4gJCRhZG9wdChpbm5lckNoaWxkLCBlKSk7XG5cbiAgICBpZiAoY2hpbGQpXG4gICAgICBlLmFwcGVuZENoaWxkKFxuICAgICAgICAodHlwZW9mIGNoaWxkID09PSAnb2JqZWN0JykgP1xuICAgICAgICBjaGlsZCA6IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNoaWxkIHx8ICcnKSk7XG5cbn1cblxuLyoqXG4gKiAkJHJlZ2lzdGVyIGEgV2lkZ2V0IG9yIE5vZGUgYnkgdGhlIHNwZWNpZmllZCB3bWw6aWRcbiAqIEBwYXJhbSB7c3RyaW5nfSBpZFxuICogQHBhcmFtIHtXaWRnZXR8Tm9kZX0gdGFyZ2V0XG4gKiBAcGFyYW0ge29iamVjdH0gaWRzXG4gKi9cbmZ1bmN0aW9uICQkcmVnaXN0ZXIoaWQsIHRhcmdldCwgaWRzKSB7XG5cbiAgaWYgKGlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgdGhyb3cgbmV3IEVycm9yKCdEdXBsaWNhdGUgaWQgXFxcXCcnICtpZCsnXFxcXCcgZGV0ZWN0ZWQhJyk7XG5cbiAgaWRzW2lkXSA9IHRhcmdldDtcblxuICByZXR1cm4gdGFyZ2V0O1xuXG59XG5cbi8qKlxuICogJCR0ZXh0IGNyZWF0ZXMgYSBET01UZXh0Tm9kZVxuICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlXG4gKi9cbmZ1bmN0aW9uICQkdGV4dCh2YWx1ZSkge1xuXG4gIHJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh2YWx1ZSB8fCAnJyk7XG5cbn1cblxuLyoqXG4gKiAkJHJlc29sdmUgcHJvcGVydHkgYWNjZXNzIGV4cHJlc3Npb24gdG8gYXZvaWRcbiAqIHRob3dpbmcgZXJyb3JzIGlmIGl0IGRvZXMgbm90IGV4aXN0LlxuICogQHBhcmFtIHtvYmplY3R9IGhlYWRcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoXG4gKi9cbmZ1bmN0aW9uICQkcmVzb2x2ZShoZWFkLCBwYXRoKSB7XG5cbiAgdmFyIHJldCA9ICQkcHJvcGVydHkocGF0aCwgaGVhZCk7XG5cbiAgcmV0dXJuIChyZXQgPT0gbnVsbCkgPyAnJyA6IHJldDtcblxufVxuXG4vKipcbiAqICQkbm9kZSBpcyBjYWxsZWQgdG8gY3JlYXRlIGEgcmVndWxhciBET00gbm9kZVxuICogQHBhcmFtIHtzdHJpbmd9IHRhZ1xuICogQHBhcmFtIHtvYmplY3R9IGF0dHJpYnV0ZXNcbiAqIEBwYXJhbSB7YXJyYXk8c3RyaW5nfG51bWJlcnxXaWRnZXQ+fSBjaGlsZHJlblxuICogQHBhcmFtIHtWaWV3fSB2aWV3XG4gKi9cbmZ1bmN0aW9uICQkbm9kZSh0YWcsIGF0dHJpYnV0ZXMsIGNoaWxkcmVuLCB2aWV3KSB7XG5cbiAgdmFyIGUgPSAodGFnID09PSAnZnJhZ21lbnQnKSA/IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSA6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcblxuICBpZiAodHlwZW9mIGF0dHJpYnV0ZXMuaHRtbCA9PT0gJ29iamVjdCcpXG4gICAgT2JqZWN0LmtleXMoYXR0cmlidXRlcy5odG1sKS5mb3JFYWNoKGtleSA9PiB7XG5cbiAgICAgIGlmICh0eXBlb2YgYXR0cmlidXRlcy5odG1sW2tleV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgZVtrZXldID0gYXR0cmlidXRlcy5odG1sW2tleV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIGF0dHJpYnV0ZXMuaHRtbFtrZXldKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICBjaGlsZHJlbi5mb3JFYWNoKGMgPT4gJCRhZG9wdChjLCBlKSk7XG5cbiAgaWYgKGF0dHJpYnV0ZXMud21sKVxuICAgIGlmIChhdHRyaWJ1dGVzLndtbC5pZClcbiAgICAgICQkcmVnaXN0ZXIoYXR0cmlidXRlcy53bWwuaWQsIGUsIHZpZXcuaWRzKTtcblxuICByZXR1cm4gZTtcblxufVxuXG4vKipcbiAqIEF0dHJpYnV0ZXMgcHJvdmlkZXMgYW4gQVBJIGZvciByZWFkaW5nIHRoZVxuICogYXR0cmlidXRlcyBzdXBwbGllZCB0byBhbiBFbGVtZW50LlxuICogQHBhcmFtIHtvYmplY3R9IGF0dHJzXG4gKi9cbmNsYXNzIEF0dHJpYnV0ZXMge1xuXG4gICAgY29uc3RydWN0b3IoJHt0cyhvLCAncHVibGljIF9hdHRyczphbnknLCAgJ19hdHRycycpfSkge1xuXG4gICAgICAgIHRoaXMuX2F0dHJzID0gX2F0dHJzO1xuXG4gICAgfVxuXG4gICAgJHt0cyhvLCAnaGFzKHBhdGg6c3RyaW5nKTogYm9vbGVhbicsICdoYXMocGF0aCknKX17XG5cbiAgICAgIHJldHVybiB0aGlzLnJlYWQocGF0aCkgPT0gbnVsbDtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHJlYWQgYSB2YWx1ZSBmb3JtIHRoZSBpbnRlcm5hbCBsaXN0LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoXG4gICAgICogQHBhcmFtIHsqfSBkZWZhdWx0VmFsdWUgLSBUaGlzIHZhbHVlIGlzIHJldHVybmVkIGlmIHRoZSB2YWx1ZSBpcyBub3Qgc2V0LlxuICAgICAqL1xuICAgICR7dHMobywgJ3JlYWQ8QT4ocGF0aDpzdHJpbmcsIGRlZmF1bHRWYWx1ZT86QSk6IEEnLCAncmVhZChwYXRoLCBkZWZhdWx0VmFsdWUpJyl9IHtcblxuICAgICAgICB2YXIgcmV0ID0gJCRwcm9wZXJ0eShwYXRoLnNwbGl0KCc6Jykuam9pbignLicpLCB0aGlzLl9hdHRycyk7XG4gICAgICByZXR1cm4gKHJldCAhPSBudWxsKSA/IHJldCA6IChkZWZhdWx0VmFsdWUgIT0gbnVsbCkgPyBkZWZhdWx0VmFsdWUgOiAnJztcblxuICAgIH1cblxufVxuXG5cbi8qKlxuICogJCR3aWRnZXQgY3JlYXRlcyBhIHdtbCB3aWRnZXQuXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBDb25zdHJ1dG9yXG4gKiBAcGFyYW0ge29iamVjdH0gYXR0cmlidXRlc1xuICogQHBhcmFtIHthcnJheTxzdHJpbmd8bnVtYmVyfFdpZGdldD59IGNoaWxkcmVuXG4gKiBAcGFyYW0ge1ZpZXd9IHZpZXdcbiAqIEByZXR1cm4ge1dpZGdldH1cbiAqL1xuZnVuY3Rpb24gJCR3aWRnZXQoQ29uc3RydWN0b3IsIGF0dHJpYnV0ZXMsIGNoaWxkcmVuLCB2aWV3KSB7XG5cbiAgdmFyIGNoaWxkcyA9IFtdO1xuICB2YXIgdztcblxuICBjaGlsZHJlbi5mb3JFYWNoKGNoaWxkID0+IEFycmF5LmlzQXJyYXkoY2hpbGQpID9cbiAgICBjaGlsZHMucHVzaC5hcHBseShjaGlsZHMsIGNoaWxkKSA6IGNoaWxkcy5wdXNoKGNoaWxkKSk7XG5cbiAgdyA9IG5ldyBDb25zdHJ1Y3RvcihuZXcgQXR0cmlidXRlcyhhdHRyaWJ1dGVzKSwgY2hpbGRzKTtcblxuICBpZiAoYXR0cmlidXRlcy53bWwpXG4gICAgaWYgKGF0dHJpYnV0ZXMud21sLmlkKVxuICAgICAgJCRyZWdpc3RlcihhdHRyaWJ1dGVzLndtbC5pZCwgdywgdmlldy5pZHMpO1xuXG4gIHZpZXcud2lkZ2V0cy5wdXNoKHcpO1xuICByZXR1cm4gdy5yZW5kZXIoKTtcblxufVxuXG4vKipcbiAqICQkaWYgaXMgY2FsbGVkIHRvIGNyZWF0ZSBhbiBpZiBjb25kaXRpb25hbCBjb25zdHJ1Y3RcbiAqIEBwYXJhbSB7Kn0gcHJlZGljYXRlXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBwb3NpdGl2ZVxuICogQHBhcmFtIHtmdW5jdGlvbn0gbmVnYXRpdmVcbiAqL1xuZnVuY3Rpb24gJCRpZihwcmVkaWNhdGUsIHBvc2l0aXZlLCBuZWdhdGl2ZSkge1xuXG4gIHJldHVybiAocHJlZGljYXRlKSA/IHBvc2l0aXZlKCkgOiBuZWdhdGl2ZSgpO1xuXG59XG5cbi8qKlxuICogJCRmb3IgaXMgY2FsbGVkIHRvIGNyZWF0ZSBhIGZvciBsb29wIGNvbnN0cnVjdFxuICogQHBhcmFtIHtJdGVyYWJsZX0gY29sbGVjdGlvblxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2JcbiAqL1xuZnVuY3Rpb24gJCRmb3IoY29sbGVjdGlvbiwgY2IpIHtcblxuICBpZiAoQXJyYXkuaXNBcnJheShjb2xsZWN0aW9uKSkge1xuXG4gICAgcmV0dXJuIGNvbGxlY3Rpb24ubWFwKGNiKTtcblxuICAgfSBlbHNlIGlmICh0eXBlb2YgY29sbGVjdGlvbiA9PT0gJ29iamVjdCcpIHtcblxuICAgICByZXR1cm4gT2JqZWN0LmtleXMoY29sbGVjdGlvbikubWFwKChrZXksIF8sIGFsbCkgPT4gY2IoY29sbGVjdGlvbltrZXldLCBrZXksIGFsbCkpO1xuXG4gICB9XG5cbiAgICByZXR1cm4gW107XG5cbn1cblxuLyoqXG4gKiAkJHN3aXRjaCBzaW11bGF0ZXMgYSBzd2l0Y2ggc3RhdGVtZW50XG4gKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ8Ym9vbGVhbn0gdmFsdWVcbiAqIEBwYXJhbSB7b2JqZWN0fSBjYXNlc1xuICovXG5mdW5jdGlvbiAkJHN3aXRjaCh2YWx1ZSwgY2FzZXMpIHtcblxuICAgIHZhciByZXN1bHQgPSBjYXNlc1t2YWx1ZV07XG4gICAgdmFyIGRlZmF1bCA9IGNhc2VzLmRlZmF1bHQ7XG5cbiAgICBpZiAocmVzdWx0KSByZXR1cm4gcmVzdWx0O1xuXG4gICAgaWYgKGRlZmF1bCkgcmV0dXJuIGRlZmF1bDtcblxufVxuXG4ke3RzKG8sIHZpZXcoKSl9XG4ke3RzKG8sIHdpZGdldCgpKX1cbiR7dHMobywgZWxlbWVudCgpKX1cblxuYDtcblxuIl19