'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
/* The property-seek module literally copied and pasted here for conveinence. */

var ts = function ts(o, txt) {
  var dtxt = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';
  return o.typescript ? txt : dtxt;
};

var view = function view() {
  return '\n\nexport interface View {\n\n render(): HTMLElement;\n findById(id:string): WMLElement;\n\n}\n';
};

var widget = function widget() {
  return '\nexport interface Widget {\n\n  rendered(): void;\n  removed(): void;\n  render(): HTMLElement;\n\n}';
};

var element = function element() {
  return '\nexport type WMLElement = HTMLElement | Node | EventTarget | Widget';
};

exports.default = function (o) {
  return '\nfunction $$boundary_to_dot(value) {\n  return value.split(\'][\').join(\'.\').split(\'[\').join(\'.\');\n}\n\nfunction $$strip_braces(value) {\n  return value.split(\'[\').join(\'.\').split(\']\').join(\'\');\n}\n\nfunction $$escape_dots(value) {\n  value = value.split(\'\\\'\');\n  return (value.length < 3) ? value.join(\'\\\'\') : value.map(function(seg) {\n    if (seg.length < 3) return seg;\n    if ((seg[0] === \'.\') || (seg[seg.length - 1] === \'.\')) return seg;\n    return seg.split(\'.\').join(\'&&\');\n  }).join(\'\');\n}\n\nfunction $$unescape_dots(value) {\n  return value.split(\'&&\').join(\'.\');\n}\n\nfunction $$partify(value) {\n  if (!value) return;\n  return $$escape_dots($$strip_braces($$boundary_to_dot(\'\' + value))).split(\'.\');\n}\n\nfunction $$property(path, o) {\n\n  var parts = $$partify(path);\n  var first;\n\n  if (typeof o !== \'object\')\n    throw new TypeError(\'get(): expects an object got \' + typeof o);\n\n  if (parts.length === 1) return o[$$unescape_dots(parts[0])];\n  if (parts.length === 0) return;\n\n  first = o[parts.shift()];\n\n  return ((typeof o === \'object\') && (o !== null)) ?\n\n    parts.reduce(function(target, prop) {\n      if (target == null) return target;\n      return target[$$unescape_dots(prop)];\n    }, first) : null;\n}\n\nfunction $$adopt(child, e) {\n\n    if (Array.isArray(child))\n      return child.forEach(innerChild => $$adopt(innerChild, e));\n\n    if (child)\n      e.appendChild(\n        (typeof child === \'object\') ?\n        child : document.createTextNode(child || \'\'));\n\n}\n\n/**\n * $$register a Widget or Node by the specified wml:id\n * @param {string} id\n * @param {Widget|Node} target\n * @param {object} ids\n */\nfunction $$register(id, target, ids) {\n\n  if (ids.hasOwnProperty(id))\n    throw new Error(\'Duplicate id \\\'\' +id+\'\\\' detected!\');\n\n  ids[id] = target;\n\n  return target;\n\n}\n\n/**\n * $$text creates a DOMTextNode\n * @param {string} value\n */\nfunction $$text(value) {\n\n  return document.createTextNode(value || \'\');\n\n}\n\n/**\n * $$resolve property access expression to avoid\n * thowing errors if it does not exist.\n * @param {object} head\n * @param {string} path\n */\nfunction $$resolve(head, path) {\n\n  var ret = $$property(head, path);\n\n  return (ret == null) ? \'\' : ret;\n\n}\n\n/**\n * $$node is called to create a regular DOM node\n * @param {string} tag\n * @param {object} attributes\n * @param {array<string|number|Widget>} children\n * @param {View} view\n */\nfunction $$node(tag, attributes, children, view) {\n\n  var e = (tag === \'fragment\') ? document.createDocumentFragment() : document.createElement(tag);\n\n  if (typeof attributes.html === \'object\')\n    Object.keys(attributes.html).forEach(key => {\n\n      if (typeof attributes.html[key] === \'function\') {\n        e[key] = attributes.html[key];\n      } else {\n        e.setAttribute(key, attributes.html[key]);\n      }\n    });\n\n  children.forEach(c => $$adopt(c, e));\n\n  if (attributes.wml)\n    if (attributes.wml.id)\n      $$register(attributes.wml.id, e, view.ids);\n\n  return e;\n\n}\n\n/**\n * Attributes provides an API for reading the\n * attributes supplied to an Element.\n * @param {object} attrs\n */\nclass Attributes {\n\n    constructor(' + ts(o, 'public _attrs:any', '_attrs') + ') {\n\n        this._attrs = _attrs;\n\n    }\n\n    /**\n     * read a value form the internal list.\n     * @param {string} path\n     * @param {*} defaultValue - This value is returned if the value is not set.\n     */\n    ' + ts(o, 'read<A>(path:string, defaultValue?:A): A', 'read(path, defaultValue)') + ' {\n\n        var ret = $$property(this._attrs, path.split(\':\').join(\'.\'));\n      return (ret != null) ? ret : (defaultValue != null) ? defaultValue : \'\';\n\n    }\n\n}\n\n\n/**\n * $$widget creates a wml widget.\n * @param {function} Construtor\n * @param {object} attributes\n * @param {array<string|number|Widget>} children\n * @param {View} view\n * @return {Widget}\n */\nfunction $$widget(Constructor, attributes, children, view) {\n\n  var childs = [];\n  var w;\n\n  children.forEach(child => Array.isArray(child) ?\n    childs.push.apply(childs, child) : childs.push(child));\n\n  w = new Constructor(new Attributes(attributes), childs);\n\n  if (attributes.wml)\n    if (attributes.wml.id)\n      $$register(attributes.wml.id, w, view.ids);\n\n  view.widgets.push(w);\n  return w.render();\n\n}\n\n/**\n * $$if is called to create an if conditional construct\n * @param {*} predicate\n * @param {function} positive\n * @param {function} negative\n */\nfunction $$if(predicate, positive, negative) {\n\n  return (predicate) ? positive() : negative();\n\n}\n\n/**\n * $$for is called to create a for loop construct\n * @param {Iterable} collection\n * @param {function} cb\n */\nfunction $$for(collection, cb) {\n\n  if (Array.isArray(collection)) {\n\n    return collection.map(cb);\n\n   } else if (typeof collection === \'object\') {\n\n     return Object.keys(collection).map((key, _, all) => cb(collection[key], key, all));\n\n   }\n\n    return [];\n\n}\n\n/**\n * $$switch simulates a switch statement\n * @param {string|number|boolean} value\n * @param {object} cases\n */\nfunction $$switch(value, cases) {\n\n    var result = cases[value];\n    var defaul = cases.default;\n\n    if (result) return result;\n\n    if (defaul) return defaul;\n\n}\n\n' + ts(o, view()) + '\n' + ts(o, widget()) + '\n' + ts(o, element()) + '\n\n';
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wYXJzZXIvcHJlYW1ibGUuanMiXSwibmFtZXMiOlsidHMiLCJvIiwidHh0IiwiZHR4dCIsInR5cGVzY3JpcHQiLCJ2aWV3Iiwid2lkZ2V0IiwiZWxlbWVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7QUFFQSxJQUFNQSxLQUFLLFNBQUxBLEVBQUssQ0FBQ0MsQ0FBRCxFQUFJQyxHQUFKO0FBQUEsTUFBU0MsSUFBVCx1RUFBZ0IsRUFBaEI7QUFBQSxTQUF1QkYsRUFBRUcsVUFBRixHQUFlRixHQUFmLEdBQXFCQyxJQUE1QztBQUFBLENBQVg7O0FBRUEsSUFBTUUsT0FBTyxTQUFQQSxJQUFPO0FBQUE7QUFBQSxDQUFiOztBQVVBLElBQU1DLFNBQVMsU0FBVEEsTUFBUztBQUFBO0FBQUEsQ0FBZjs7QUFTQSxJQUFNQyxVQUFVLFNBQVZBLE9BQVU7QUFBQTtBQUFBLENBQWhCOztrQkFHZTtBQUFBLG12R0EySUdQLEdBQUdDLENBQUgsRUFBTSxtQkFBTixFQUE0QixRQUE1QixDQTNJSCwyT0FzSlRELEdBQUdDLENBQUgsRUFBTSwwQ0FBTixFQUFrRCwwQkFBbEQsQ0F0SlMsc3ZEQTRPYkQsR0FBR0MsQ0FBSCxFQUFNSSxNQUFOLENBNU9hLFVBNk9iTCxHQUFHQyxDQUFILEVBQU1LLFFBQU4sQ0E3T2EsVUE4T2JOLEdBQUdDLENBQUgsRUFBTU0sU0FBTixDQTlPYTtBQUFBLEMiLCJmaWxlIjoicHJlYW1ibGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBUaGUgcHJvcGVydHktc2VlayBtb2R1bGUgbGl0ZXJhbGx5IGNvcGllZCBhbmQgcGFzdGVkIGhlcmUgZm9yIGNvbnZlaW5lbmNlLiAqL1xuXG5jb25zdCB0cyA9IChvLCB0eHQsIGR0eHQgPSAnJykgPT4gby50eXBlc2NyaXB0ID8gdHh0IDogZHR4dDtcblxuY29uc3QgdmlldyA9ICgpID0+IGBcblxuZXhwb3J0IGludGVyZmFjZSBWaWV3IHtcblxuIHJlbmRlcigpOiBIVE1MRWxlbWVudDtcbiBmaW5kQnlJZChpZDpzdHJpbmcpOiBXTUxFbGVtZW50O1xuXG59XG5gO1xuXG5jb25zdCB3aWRnZXQgPSAoKSA9PiBgXG5leHBvcnQgaW50ZXJmYWNlIFdpZGdldCB7XG5cbiAgcmVuZGVyZWQoKTogdm9pZDtcbiAgcmVtb3ZlZCgpOiB2b2lkO1xuICByZW5kZXIoKTogSFRNTEVsZW1lbnQ7XG5cbn1gO1xuXG5jb25zdCBlbGVtZW50ID0gKCkgPT4gYFxuZXhwb3J0IHR5cGUgV01MRWxlbWVudCA9IEhUTUxFbGVtZW50IHwgTm9kZSB8IEV2ZW50VGFyZ2V0IHwgV2lkZ2V0YDtcblxuZXhwb3J0IGRlZmF1bHQgbyA9PiBgXG5mdW5jdGlvbiAkJGJvdW5kYXJ5X3RvX2RvdCh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUuc3BsaXQoJ11bJykuam9pbignLicpLnNwbGl0KCdbJykuam9pbignLicpO1xufVxuXG5mdW5jdGlvbiAkJHN0cmlwX2JyYWNlcyh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUuc3BsaXQoJ1snKS5qb2luKCcuJykuc3BsaXQoJ10nKS5qb2luKCcnKTtcbn1cblxuZnVuY3Rpb24gJCRlc2NhcGVfZG90cyh2YWx1ZSkge1xuICB2YWx1ZSA9IHZhbHVlLnNwbGl0KCdcXFxcJycpO1xuICByZXR1cm4gKHZhbHVlLmxlbmd0aCA8IDMpID8gdmFsdWUuam9pbignXFxcXCcnKSA6IHZhbHVlLm1hcChmdW5jdGlvbihzZWcpIHtcbiAgICBpZiAoc2VnLmxlbmd0aCA8IDMpIHJldHVybiBzZWc7XG4gICAgaWYgKChzZWdbMF0gPT09ICcuJykgfHwgKHNlZ1tzZWcubGVuZ3RoIC0gMV0gPT09ICcuJykpIHJldHVybiBzZWc7XG4gICAgcmV0dXJuIHNlZy5zcGxpdCgnLicpLmpvaW4oJyYmJyk7XG4gIH0pLmpvaW4oJycpO1xufVxuXG5mdW5jdGlvbiAkJHVuZXNjYXBlX2RvdHModmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlLnNwbGl0KCcmJicpLmpvaW4oJy4nKTtcbn1cblxuZnVuY3Rpb24gJCRwYXJ0aWZ5KHZhbHVlKSB7XG4gIGlmICghdmFsdWUpIHJldHVybjtcbiAgcmV0dXJuICQkZXNjYXBlX2RvdHMoJCRzdHJpcF9icmFjZXMoJCRib3VuZGFyeV90b19kb3QoJycgKyB2YWx1ZSkpKS5zcGxpdCgnLicpO1xufVxuXG5mdW5jdGlvbiAkJHByb3BlcnR5KHBhdGgsIG8pIHtcblxuICB2YXIgcGFydHMgPSAkJHBhcnRpZnkocGF0aCk7XG4gIHZhciBmaXJzdDtcblxuICBpZiAodHlwZW9mIG8gIT09ICdvYmplY3QnKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2dldCgpOiBleHBlY3RzIGFuIG9iamVjdCBnb3QgJyArIHR5cGVvZiBvKTtcblxuICBpZiAocGFydHMubGVuZ3RoID09PSAxKSByZXR1cm4gb1skJHVuZXNjYXBlX2RvdHMocGFydHNbMF0pXTtcbiAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gIGZpcnN0ID0gb1twYXJ0cy5zaGlmdCgpXTtcblxuICByZXR1cm4gKCh0eXBlb2YgbyA9PT0gJ29iamVjdCcpICYmIChvICE9PSBudWxsKSkgP1xuXG4gICAgcGFydHMucmVkdWNlKGZ1bmN0aW9uKHRhcmdldCwgcHJvcCkge1xuICAgICAgaWYgKHRhcmdldCA9PSBudWxsKSByZXR1cm4gdGFyZ2V0O1xuICAgICAgcmV0dXJuIHRhcmdldFskJHVuZXNjYXBlX2RvdHMocHJvcCldO1xuICAgIH0sIGZpcnN0KSA6IG51bGw7XG59XG5cbmZ1bmN0aW9uICQkYWRvcHQoY2hpbGQsIGUpIHtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KGNoaWxkKSlcbiAgICAgIHJldHVybiBjaGlsZC5mb3JFYWNoKGlubmVyQ2hpbGQgPT4gJCRhZG9wdChpbm5lckNoaWxkLCBlKSk7XG5cbiAgICBpZiAoY2hpbGQpXG4gICAgICBlLmFwcGVuZENoaWxkKFxuICAgICAgICAodHlwZW9mIGNoaWxkID09PSAnb2JqZWN0JykgP1xuICAgICAgICBjaGlsZCA6IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNoaWxkIHx8ICcnKSk7XG5cbn1cblxuLyoqXG4gKiAkJHJlZ2lzdGVyIGEgV2lkZ2V0IG9yIE5vZGUgYnkgdGhlIHNwZWNpZmllZCB3bWw6aWRcbiAqIEBwYXJhbSB7c3RyaW5nfSBpZFxuICogQHBhcmFtIHtXaWRnZXR8Tm9kZX0gdGFyZ2V0XG4gKiBAcGFyYW0ge29iamVjdH0gaWRzXG4gKi9cbmZ1bmN0aW9uICQkcmVnaXN0ZXIoaWQsIHRhcmdldCwgaWRzKSB7XG5cbiAgaWYgKGlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgdGhyb3cgbmV3IEVycm9yKCdEdXBsaWNhdGUgaWQgXFxcXCcnICtpZCsnXFxcXCcgZGV0ZWN0ZWQhJyk7XG5cbiAgaWRzW2lkXSA9IHRhcmdldDtcblxuICByZXR1cm4gdGFyZ2V0O1xuXG59XG5cbi8qKlxuICogJCR0ZXh0IGNyZWF0ZXMgYSBET01UZXh0Tm9kZVxuICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlXG4gKi9cbmZ1bmN0aW9uICQkdGV4dCh2YWx1ZSkge1xuXG4gIHJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh2YWx1ZSB8fCAnJyk7XG5cbn1cblxuLyoqXG4gKiAkJHJlc29sdmUgcHJvcGVydHkgYWNjZXNzIGV4cHJlc3Npb24gdG8gYXZvaWRcbiAqIHRob3dpbmcgZXJyb3JzIGlmIGl0IGRvZXMgbm90IGV4aXN0LlxuICogQHBhcmFtIHtvYmplY3R9IGhlYWRcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoXG4gKi9cbmZ1bmN0aW9uICQkcmVzb2x2ZShoZWFkLCBwYXRoKSB7XG5cbiAgdmFyIHJldCA9ICQkcHJvcGVydHkoaGVhZCwgcGF0aCk7XG5cbiAgcmV0dXJuIChyZXQgPT0gbnVsbCkgPyAnJyA6IHJldDtcblxufVxuXG4vKipcbiAqICQkbm9kZSBpcyBjYWxsZWQgdG8gY3JlYXRlIGEgcmVndWxhciBET00gbm9kZVxuICogQHBhcmFtIHtzdHJpbmd9IHRhZ1xuICogQHBhcmFtIHtvYmplY3R9IGF0dHJpYnV0ZXNcbiAqIEBwYXJhbSB7YXJyYXk8c3RyaW5nfG51bWJlcnxXaWRnZXQ+fSBjaGlsZHJlblxuICogQHBhcmFtIHtWaWV3fSB2aWV3XG4gKi9cbmZ1bmN0aW9uICQkbm9kZSh0YWcsIGF0dHJpYnV0ZXMsIGNoaWxkcmVuLCB2aWV3KSB7XG5cbiAgdmFyIGUgPSAodGFnID09PSAnZnJhZ21lbnQnKSA/IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSA6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcblxuICBpZiAodHlwZW9mIGF0dHJpYnV0ZXMuaHRtbCA9PT0gJ29iamVjdCcpXG4gICAgT2JqZWN0LmtleXMoYXR0cmlidXRlcy5odG1sKS5mb3JFYWNoKGtleSA9PiB7XG5cbiAgICAgIGlmICh0eXBlb2YgYXR0cmlidXRlcy5odG1sW2tleV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgZVtrZXldID0gYXR0cmlidXRlcy5odG1sW2tleV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIGF0dHJpYnV0ZXMuaHRtbFtrZXldKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICBjaGlsZHJlbi5mb3JFYWNoKGMgPT4gJCRhZG9wdChjLCBlKSk7XG5cbiAgaWYgKGF0dHJpYnV0ZXMud21sKVxuICAgIGlmIChhdHRyaWJ1dGVzLndtbC5pZClcbiAgICAgICQkcmVnaXN0ZXIoYXR0cmlidXRlcy53bWwuaWQsIGUsIHZpZXcuaWRzKTtcblxuICByZXR1cm4gZTtcblxufVxuXG4vKipcbiAqIEF0dHJpYnV0ZXMgcHJvdmlkZXMgYW4gQVBJIGZvciByZWFkaW5nIHRoZVxuICogYXR0cmlidXRlcyBzdXBwbGllZCB0byBhbiBFbGVtZW50LlxuICogQHBhcmFtIHtvYmplY3R9IGF0dHJzXG4gKi9cbmNsYXNzIEF0dHJpYnV0ZXMge1xuXG4gICAgY29uc3RydWN0b3IoJHt0cyhvLCAncHVibGljIF9hdHRyczphbnknLCAgJ19hdHRycycpfSkge1xuXG4gICAgICAgIHRoaXMuX2F0dHJzID0gX2F0dHJzO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogcmVhZCBhIHZhbHVlIGZvcm0gdGhlIGludGVybmFsIGxpc3QuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHBhdGhcbiAgICAgKiBAcGFyYW0geyp9IGRlZmF1bHRWYWx1ZSAtIFRoaXMgdmFsdWUgaXMgcmV0dXJuZWQgaWYgdGhlIHZhbHVlIGlzIG5vdCBzZXQuXG4gICAgICovXG4gICAgJHt0cyhvLCAncmVhZDxBPihwYXRoOnN0cmluZywgZGVmYXVsdFZhbHVlPzpBKTogQScsICdyZWFkKHBhdGgsIGRlZmF1bHRWYWx1ZSknKX0ge1xuXG4gICAgICAgIHZhciByZXQgPSAkJHByb3BlcnR5KHRoaXMuX2F0dHJzLCBwYXRoLnNwbGl0KCc6Jykuam9pbignLicpKTtcbiAgICAgIHJldHVybiAocmV0ICE9IG51bGwpID8gcmV0IDogKGRlZmF1bHRWYWx1ZSAhPSBudWxsKSA/IGRlZmF1bHRWYWx1ZSA6ICcnO1xuXG4gICAgfVxuXG59XG5cblxuLyoqXG4gKiAkJHdpZGdldCBjcmVhdGVzIGEgd21sIHdpZGdldC5cbiAqIEBwYXJhbSB7ZnVuY3Rpb259IENvbnN0cnV0b3JcbiAqIEBwYXJhbSB7b2JqZWN0fSBhdHRyaWJ1dGVzXG4gKiBAcGFyYW0ge2FycmF5PHN0cmluZ3xudW1iZXJ8V2lkZ2V0Pn0gY2hpbGRyZW5cbiAqIEBwYXJhbSB7Vmlld30gdmlld1xuICogQHJldHVybiB7V2lkZ2V0fVxuICovXG5mdW5jdGlvbiAkJHdpZGdldChDb25zdHJ1Y3RvciwgYXR0cmlidXRlcywgY2hpbGRyZW4sIHZpZXcpIHtcblxuICB2YXIgY2hpbGRzID0gW107XG4gIHZhciB3O1xuXG4gIGNoaWxkcmVuLmZvckVhY2goY2hpbGQgPT4gQXJyYXkuaXNBcnJheShjaGlsZCkgP1xuICAgIGNoaWxkcy5wdXNoLmFwcGx5KGNoaWxkcywgY2hpbGQpIDogY2hpbGRzLnB1c2goY2hpbGQpKTtcblxuICB3ID0gbmV3IENvbnN0cnVjdG9yKG5ldyBBdHRyaWJ1dGVzKGF0dHJpYnV0ZXMpLCBjaGlsZHMpO1xuXG4gIGlmIChhdHRyaWJ1dGVzLndtbClcbiAgICBpZiAoYXR0cmlidXRlcy53bWwuaWQpXG4gICAgICAkJHJlZ2lzdGVyKGF0dHJpYnV0ZXMud21sLmlkLCB3LCB2aWV3Lmlkcyk7XG5cbiAgdmlldy53aWRnZXRzLnB1c2godyk7XG4gIHJldHVybiB3LnJlbmRlcigpO1xuXG59XG5cbi8qKlxuICogJCRpZiBpcyBjYWxsZWQgdG8gY3JlYXRlIGFuIGlmIGNvbmRpdGlvbmFsIGNvbnN0cnVjdFxuICogQHBhcmFtIHsqfSBwcmVkaWNhdGVcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IHBvc2l0aXZlXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBuZWdhdGl2ZVxuICovXG5mdW5jdGlvbiAkJGlmKHByZWRpY2F0ZSwgcG9zaXRpdmUsIG5lZ2F0aXZlKSB7XG5cbiAgcmV0dXJuIChwcmVkaWNhdGUpID8gcG9zaXRpdmUoKSA6IG5lZ2F0aXZlKCk7XG5cbn1cblxuLyoqXG4gKiAkJGZvciBpcyBjYWxsZWQgdG8gY3JlYXRlIGEgZm9yIGxvb3AgY29uc3RydWN0XG4gKiBAcGFyYW0ge0l0ZXJhYmxlfSBjb2xsZWN0aW9uXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYlxuICovXG5mdW5jdGlvbiAkJGZvcihjb2xsZWN0aW9uLCBjYikge1xuXG4gIGlmIChBcnJheS5pc0FycmF5KGNvbGxlY3Rpb24pKSB7XG5cbiAgICByZXR1cm4gY29sbGVjdGlvbi5tYXAoY2IpO1xuXG4gICB9IGVsc2UgaWYgKHR5cGVvZiBjb2xsZWN0aW9uID09PSAnb2JqZWN0Jykge1xuXG4gICAgIHJldHVybiBPYmplY3Qua2V5cyhjb2xsZWN0aW9uKS5tYXAoKGtleSwgXywgYWxsKSA9PiBjYihjb2xsZWN0aW9uW2tleV0sIGtleSwgYWxsKSk7XG5cbiAgIH1cblxuICAgIHJldHVybiBbXTtcblxufVxuXG4vKipcbiAqICQkc3dpdGNoIHNpbXVsYXRlcyBhIHN3aXRjaCBzdGF0ZW1lbnRcbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcnxib29sZWFufSB2YWx1ZVxuICogQHBhcmFtIHtvYmplY3R9IGNhc2VzXG4gKi9cbmZ1bmN0aW9uICQkc3dpdGNoKHZhbHVlLCBjYXNlcykge1xuXG4gICAgdmFyIHJlc3VsdCA9IGNhc2VzW3ZhbHVlXTtcbiAgICB2YXIgZGVmYXVsID0gY2FzZXMuZGVmYXVsdDtcblxuICAgIGlmIChyZXN1bHQpIHJldHVybiByZXN1bHQ7XG5cbiAgICBpZiAoZGVmYXVsKSByZXR1cm4gZGVmYXVsO1xuXG59XG5cbiR7dHMobywgdmlldygpKX1cbiR7dHMobywgd2lkZ2V0KCkpfVxuJHt0cyhvLCBlbGVtZW50KCkpfVxuXG5gO1xuXG4iXX0=