'use strict';

var Transpiler = require('./transpiler/Transpiler');
var through = require('through');
var babel = require('babel-core');

var transpiler = new Transpiler();

function transform(file) {

    var data = '';

    function write(buf) {
        data += buf;
    }

    function end() {

        var js;

        try {
            js = transpiler.transpile(data);
        } catch (e) {
            console.error(e);
            throw e;
        }

        this.queue(babel.transform(js, {
            sourceMaps: true
        }).code);

        this.queue(null);
    }

    if (!/\.wml$/.test(file)) return through();
    return through(write, end);
}

module.exports = transform;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy90cmFuc2Zvcm0uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMseUJBQXlCLENBQUMsQ0FBQztBQUNwRCxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDakMsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDOztBQUVsQyxJQUFJLFVBQVUsR0FBRyxJQUFJLFVBQVUsRUFBRSxDQUFDOztBQUVsQyxTQUFTLFNBQVMsQ0FBQyxJQUFJLEVBQUU7O0FBRXJCLFFBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQzs7QUFFZCxhQUFTLEtBQUssQ0FBQyxHQUFHLEVBQUU7QUFDaEIsWUFBSSxJQUFJLEdBQUcsQ0FBQztLQUNmOztBQUVELGFBQVMsR0FBRyxHQUFHOztBQUVYLFlBQUksRUFBRSxDQUFDOztBQUVQLFlBQUk7QUFDQSxjQUFFLEdBQUcsVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNuQyxDQUFDLE9BQU8sQ0FBQyxFQUFFO0FBQ1IsbUJBQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDakIsa0JBQU0sQ0FBQyxDQUFDO1NBQ1g7O0FBRUQsWUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRTtBQUMzQixzQkFBVSxFQUFFLElBQUk7U0FDbkIsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDOztBQUVULFlBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7S0FFcEI7O0FBRUQsUUFBSSxDQUFDLEFBQUMsUUFBUSxDQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLE9BQU8sRUFBRSxDQUFDO0FBQzdDLFdBQU8sT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztDQUU5Qjs7QUFFRCxNQUFNLENBQUMsT0FBTyxHQUFHLFNBQVMsQ0FBQyIsImZpbGUiOiJ0cmFuc2Zvcm0uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgVHJhbnNwaWxlciA9IHJlcXVpcmUoJy4vdHJhbnNwaWxlci9UcmFuc3BpbGVyJyk7XG52YXIgdGhyb3VnaCA9IHJlcXVpcmUoJ3Rocm91Z2gnKTtcbnZhciBiYWJlbCA9IHJlcXVpcmUoJ2JhYmVsLWNvcmUnKTtcblxudmFyIHRyYW5zcGlsZXIgPSBuZXcgVHJhbnNwaWxlcigpO1xuXG5mdW5jdGlvbiB0cmFuc2Zvcm0oZmlsZSkge1xuXG4gICAgdmFyIGRhdGEgPSAnJztcblxuICAgIGZ1bmN0aW9uIHdyaXRlKGJ1Zikge1xuICAgICAgICBkYXRhICs9IGJ1ZjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBlbmQoKSB7XG5cbiAgICAgICAgdmFyIGpzO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBqcyA9IHRyYW5zcGlsZXIudHJhbnNwaWxlKGRhdGEpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucXVldWUoYmFiZWwudHJhbnNmb3JtKGpzLCB7XG4gICAgICAgICAgICBzb3VyY2VNYXBzOiB0cnVlXG4gICAgICAgIH0pLmNvZGUpO1xuXG4gICAgICAgIHRoaXMucXVldWUobnVsbCk7XG5cbiAgICB9XG5cbiAgICBpZiAoISgvXFwud21sJC8pLnRlc3QoZmlsZSkpIHJldHVybiB0aHJvdWdoKCk7XG4gICAgcmV0dXJuIHRocm91Z2god3JpdGUsIGVuZCk7XG5cbn1cblxubW9kdWxlLmV4cG9ydHMgPSB0cmFuc2Zvcm07XG4iXX0=